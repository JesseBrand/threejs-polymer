<link rel="import" href="../jb-3js-helper-color.html" />
<link rel="import" href="../jb-3js-helper-position.html" />
<link rel="import" href="../jb-3js-helper-size.html" />
<link rel="import" href="../jb-3js-helper-texture.html" />
<script>
    'use strict';

    Polymer({
        is: 'jb-3js-skybox',
        behaviors: [PositionBehavior, SizeBehavior, ColorBehavior],
        properties: {
            textured: Boolean,
            skyboxTexture: String
        },
        attached: function() {
            var matProps = {color: this.color};
            if (this.textured) {
                matProps.map = new THREE.TextureLoader().load(this.skyboxTexture);
            }
            var material = new THREE.MeshBasicMaterial(matProps);
            material.side = THREE.BackSide;
            var geometry = new THREE.CubeGeometry(this.width, this.height, this.depth);
            if (this.textured) {
                var width = 4;
                var height = 4;
                var uvs = [width * height];
                for (var x = 0; x < width; x++) {
                    for (var y = 0; y < height; y++) {
                        uvs[y * width + x] = [
                            new THREE.Vector2(x       / 4 + .001, 1 - y       / 4 - .001),
                            new THREE.Vector2((x + 1) / 4 - .001, 1 - y       / 4 - .001),
                            new THREE.Vector2((x + 1) / 4 - .001, 1 - (y + 1) / 4 + .001),
                            new THREE.Vector2(x       / 4 + .001, 1 - (y + 1) / 4 + .001)
                        ];
                        console.log(uvs[y * width + x]);
                    }
                }
                geometry.faceVertexUvs[0][0] =  [uvs[4][1], uvs[4][2], uvs[4][0]]; // right
                geometry.faceVertexUvs[0][1] =  [uvs[4][2], uvs[4][3], uvs[4][0]];
                geometry.faceVertexUvs[0][2] =  [uvs[6][1], uvs[6][2], uvs[6][0]]; // left
                geometry.faceVertexUvs[0][3] =  [uvs[6][2], uvs[6][3], uvs[6][0]];
                geometry.faceVertexUvs[0][4] =  [uvs[1][1], uvs[1][2], uvs[1][0]]; // top
                geometry.faceVertexUvs[0][5] =  [uvs[1][2], uvs[1][3], uvs[1][0]];
                geometry.faceVertexUvs[0][6] =  [uvs[9][1], uvs[9][2], uvs[9][0]]; // bottom
                geometry.faceVertexUvs[0][7] =  [uvs[9][2], uvs[9][3], uvs[9][0]];
                geometry.faceVertexUvs[0][8] =  [uvs[5][1], uvs[5][2], uvs[5][0]]; // back
                geometry.faceVertexUvs[0][9] =  [uvs[5][2], uvs[5][3], uvs[5][0]];
                geometry.faceVertexUvs[0][10] = [uvs[7][1], uvs[7][2], uvs[7][0]]; // front
                geometry.faceVertexUvs[0][11] = [uvs[7][2], uvs[7][3], uvs[7][0]];
            }
            var mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(this.x, this.y, this.z);
            this.fire('add-to-scene', mesh);
        }
    });
</script>
